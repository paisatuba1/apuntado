<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>APUNTADO</title>

<style>
/* ===================== RESET SANO ===================== */
* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow-x: hidden; /* ðŸ”’ CLAVE: evita bordes fuera */
  background: #000;
  color: #fff;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

/* ===================== HEADER ===================== */
header {
  text-align: center;
  padding: 12px 8px;
}

h1 {
  margin: 0;
  font-size: 22px;
  letter-spacing: 2px;
}

/* ===================== CONTROLES SUPERIORES ===================== */
.controls {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin: 10px 0;
  flex-wrap: wrap;
}

select, button {
  background: #111;
  color: #fff;
  border: 1px solid #444;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 14px;
}

button:active {
  transform: scale(0.97);
}

#undoBtn {
  border-color: #ff9800;
  color: #ff9800;
}

#resetBtn {
  width: calc(100% - 16px);
  margin: 10px auto 14px;
  display: block;
  border-color: #b00000;
  color: #b00000;
}

/* ===================== JUGADORES ===================== */
#players {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
  padding: 0 6px; /* ðŸ‘ˆ margen lateral fino */
}

/* ===================== TARJETA ===================== */
.player {
  border: 1px solid #444;
  border-radius: 8px;
  padding: 6px;
  min-height: 110px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.player.disabled {
  opacity: 0.35;
}

.player.winner {
  border-color: gold;
}

/* ===================== NOMBRE ===================== */
.name {
  text-align: center;
  font-weight: bold;
  font-size: 14px;
  outline: none;
}

/* lÃ­nea sutil */
.divider {
  height: 1px;
  background: #333;
  margin: 6px 0;
}

/* ===================== PUNTOS ===================== */
.score {
  text-align: center;
  font-size: 28px;
  outline: none;
}

/* ===================== ENTRADAS ===================== */
.entry {
  text-align: center;
  font-size: 11px;
  color: #ff0;
  margin-top: 4px;
}

/* ===================== MODAL ===================== */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.modal-content {
  background: #111;
  border: 1px solid #444;
  border-radius: 10px;
  padding: 16px;
  width: 90%;
  max-width: 300px;
  text-align: center;
}

.modal-content input {
  width: 100%;
  padding: 10px;
  margin: 10px 0;
  background: #000;
  color: #fff;
  border: 1px solid #555;
  border-radius: 6px;
  font-size: 18px;
  text-align: center;
}

.modal-content button {
  margin: 5px;
}

/* ===================== RESPONSIVE ===================== */
@media (max-width: 500px) {
  #players {
    grid-template-columns: 1fr 1fr;
  }
}
</style>
</head>

<body>

<header>
  <h1>APUNTADO</h1>

  <div class="controls">
    <select id="playerCount">
      <option value="">JUGADORES</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
    </select>

    <button id="undoBtn">DESHACER</button>
  </div>
</header>

<div id="players"></div>

<button id="resetBtn">REINICIAR</button>

<!-- ===================== MODAL ===================== -->
<div class="modal" id="modal">
  <div class="modal-content" id="modalContent"></div>
</div>

<script>
/* ===================== ESTADO ===================== */
let state = JSON.parse(localStorage.getItem("apuntado")) || {
  players: [],
  history: []
};

/* ===================== ELEMENTOS ===================== */
const playersDiv = document.getElementById("players");
const selectPlayers = document.getElementById("playerCount");
const undoBtn = document.getElementById("undoBtn");
const resetBtn = document.getElementById("resetBtn");
const modal = document.getElementById("modal");
const modalContent = document.getElementById("modalContent");

/* ===================== GUARDAR ===================== */
function save() {
  localStorage.setItem("apuntado", JSON.stringify(state));
}

/* ===================== RENDER ===================== */
function render() {
  playersDiv.innerHTML = "";

  state.players.forEach((p, i) => {
    const div = document.createElement("div");
    div.className = "player" + (p.disabled ? " disabled" : "") + (p.winner ? " winner" : "");

    const name = document.createElement("div");
    name.className = "name";
    name.contentEditable = true;
    name.textContent = p.name;
    name.onfocus = () => selectAll(name);
    name.oninput = () => { p.name = name.textContent; save(); };

    const divider = document.createElement("div");
    divider.className = "divider";

    const score = document.createElement("div");
    score.className = "score";
    score.textContent = p.score;
    score.onclick = () => scoreAction(i);

    div.appendChild(name);
    div.appendChild(divider);
    div.appendChild(score);

    if (p.entry) {
      const entry = document.createElement("div");
      entry.className = "entry";
      entry.textContent = "ENTRADA";
      div.appendChild(entry);
    }

    playersDiv.appendChild(div);
  });
}

/* ===================== SELECCIONAR TEXTO ===================== */
function selectAll(el) {
  const range = document.createRange();
  range.selectNodeContents(el);
  const sel = window.getSelection();
  sel.removeAllRanges();
  sel.addRange(range);
}

/* ===================== SUMAR / RESTAR ===================== */
function scoreAction(index) {
  const p = state.players[index];
  if (p.disabled) return;

  modalContent.innerHTML = `
    <h3>${p.name}</h3>
    <input type="number" id="val" inputmode="numeric" />
    <button onclick="applyScore(${index}, 1)">SUMAR</button>
    <button onclick="applyScore(${index}, -1)">RESTAR</button>
  `;
  modal.style.display = "flex";
  setTimeout(() => document.getElementById("val").focus(), 50);
}

function applyScore(i, dir) {
  const v = Number(document.getElementById("val").value);
  if (isNaN(v)) return;

  state.history.push(JSON.stringify(state.players));
  state.players[i].score += v * dir;
  checkWinner();
  save();
  modal.style.display = "none";
  render();
}

/* ===================== GANADOR ===================== */
function checkWinner() {
  const active = state.players.filter(p => !p.disabled);

  active.forEach(p => p.winner = false);

  active.forEach(p => {
    if (p.score <= -51) declareWinner(p);
  });

  active.forEach(p => {
    if (active.filter(o => o !== p && o.score > 100).length === active.length - 1) {
      declareWinner(p);
    }
  });

  if (active.length === 1) declareWinner(active[0]);
}

function declareWinner(p) {
  p.winner = true;
  state.players.forEach(o => { if (o !== p) o.disabled = true; });
}

/* ===================== DESHACER ===================== */
undoBtn.onclick = () => {
  if (!state.history.length) return;
  state.players = JSON.parse(state.history.pop());
  save();
  render();
};

/* ===================== REINICIAR ===================== */
resetBtn.onclick = () => {
  if (!confirm("Â¿Reiniciar el juego?")) return;
  localStorage.removeItem("apuntado");
  location.reload();
};

/* ===================== JUGADORES ===================== */
selectPlayers.onchange = () => {
  const n = Number(selectPlayers.value);
  state.players = [];
  for (let i = 1; i <= n; i++) {
    state.players.push({
      name: `NOMBRE ${i}`,
      score: 0,
      disabled: false,
      winner: false,
      entry: false
    });
  }
  save();
  render();
};

/* ===================== INICIO ===================== */
render();
</script>

</body>
</html>