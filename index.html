<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>APUNTADO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { box-sizing: border-box; font-family: Arial, sans-serif; }

body {
  margin: 0;
  background: #000;
  color: #fff;
}

header {
  text-align: center;
  padding: 15px 10px 5px;
}

h1 {
  margin: 5px 0 10px;
  letter-spacing: 4px;
}

.controls {
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
}

select, button {
  background: #000;
  color: #fff;
  border: 1px solid #333;
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 16px;
}

button { cursor: pointer; }

button:disabled {
  opacity: .4;
  cursor: default;
}

.btn-save.active {
  background: #2f6b3f;
  color: #fff;
  border-color: #2f6b3f;
}

.players {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  grid-template-rows: repeat(3, 1fr);
  height: calc(100vh - 170px);
}

.player {
  border: 1px solid #222;
  padding: 10px;
  display: flex;
  flex-direction: column;
  transition: opacity .3s, border .3s;
}

.player.disabled {
  opacity: .35;
  pointer-events: none;
}

.player.winner {
  border: 2px solid #d4af37;
}

.name-zone input {
  width: 100%;
  background: transparent;
  border: none;
  color: #fff;
  text-align: center;
  font-size: 18px;
  outline: none;
}

.entradas {
  margin-top: 4px;
  background: #ffeb3b;
  color: #000;
  font-size: 13px;
  font-weight: bold;
  padding: 2px 6px;
  border-radius: 6px;
  width: fit-content;
  margin-inline: auto;
}

.divider {
  height: 1px;
  background: #333;
  margin: 8px 0;
}

.score-zone {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.score {
  font-size: 48px;
  font-weight: bold;
}

.score.out { color: #e55353; }

.winner-label {
  color: #d4af37;
  margin-top: 6px;
  font-weight: bold;
  letter-spacing: 2px;
}

.bottom {
  display: flex;
  justify-content: center;
  gap: 20px;
  padding: 10px;
}

.btn-danger {
  border-color: #6b2f2f;
  color: #e5a0a0;
}

.modal, .overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.85);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10;
}

.modal-content {
  background: #111;
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-width: 320px;
  text-align: center;
}

.modal-content input {
  width: 100%;
  padding: 12px;
  font-size: 22px;
  text-align: center;
  background: #000;
  color: #fff;
  border: 1px solid #333;
}

.modal-buttons {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

.modal-buttons button { flex: 1; }

.overlay-box {
  background: #111;
  border: 2px solid orange;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
}

.overlay-box button {
  margin: 10px;
  padding: 10px 20px;
  font-weight: bold;
}
</style>
</head>

<body>

<header>
  <h1>APUNTADO</h1>
  <div class="controls">
    <select id="count">
      <option value="">Jugadores</option>
      <option>2</option><option>3</option><option>4</option><option>5</option><option>6</option>
    </select>
    <button id="saveBtn" class="btn-save" disabled>GUARDAR</button>
  </div>
</header>

<div class="players" id="players"></div>

<div class="bottom">
  <button class="btn-danger" onclick="undo()">DESHACER</button>
  <button class="btn-danger" onclick="reset()">REINICIAR</button>
</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <input id="points" type="number" inputmode="numeric">
    <div class="modal-buttons">
      <button onclick="apply(1)">SUMAR</button>
      <button onclick="apply(-1)">RESTAR</button>
    </div>
  </div>
</div>

<div class="overlay" id="reentry">
  <div class="overlay-box">
    <div id="reText"></div>
    <button onclick="reenter(true)">SI</button>
    <button onclick="reenter(false)">NO</button>
  </div>
</div>

<script>
let history=[], current=null, reIndex=null;

const playersEl = document.getElementById("players");
const modal = document.getElementById("modal");
const input = document.getElementById("points");

function build(){
  playersEl.innerHTML="";
  const n = document.getElementById("count").value;
  if(!n) return;
  for(let i=0;i<n;i++){
    playersEl.innerHTML+=`
    <div class="player" data-i="${i}">
      <div class="name-zone"><input value="Nombre ${i+1}"></div>
      <div class="divider"></div>
      <div class="score-zone"><div class="score">0</div></div>
    </div>`;
  }
}

document.getElementById("count").onchange=()=>{
  build();
  document.getElementById("saveBtn").disabled=false;
};

document.getElementById("saveBtn").onclick=()=>{
  localStorage.setItem("apuntado", playersEl.innerHTML);
  const b=document.getElementById("saveBtn");
  b.textContent="GUARDADO";
  b.classList.add("active");
  b.disabled=true;
};

playersEl.onclick=e=>{
  const z=e.target.closest(".score-zone");
  if(!z) return;
  current=z.querySelector(".score");
  modal.style.display="flex";
  input.value="";
  setTimeout(()=>input.focus(),50);
};

function apply(m){
  history.push(playersEl.innerHTML);
  current.textContent=parseInt(current.textContent)+parseInt(input.value||0)*m;
  modal.style.display="none";
  check();
}

function check(){
  const players=[...document.querySelectorAll(".player:not(.disabled)")];
  let winner=null;

  players.forEach(p=>{
    const s=p.querySelector(".score");
    if(parseInt(s.textContent)<=-51) winner=p;
  });

  if(!winner){
    players.forEach(p=>{
      if(parseInt(p.querySelector(".score").textContent)>=101){
        reIndex=p;
        document.getElementById("reText").textContent=
        p.querySelector("input").value+" ¿reingresa?";
        document.getElementById("reentry").style.display="flex";
      }
    });
  }

  if(players.length===1) winner=players[0];

  if(winner){
    players.forEach(p=>{
      if(p!==winner) p.classList.add("disabled");
      else{
        p.classList.add("winner");
        p.innerHTML+=`<div class="winner-label">GANADOR</div>`;
      }
    });
  }
}

function reenter(ok){
  document.getElementById("reentry").style.display="none";
  if(!ok){
    reIndex.classList.add("disabled");
    reIndex.querySelector(".score").classList.add("out");
  }
}

function undo(){
  if(!history.length) return;
  playersEl.innerHTML=history.pop();
}

function reset(){
  if(confirm("¿Reiniciar?")){
    localStorage.clear();
    location.reload();
  }
}

modal.onclick=e=>{ if(e.target===modal) modal.style.display="none"; };

const saved=localStorage.getItem("apuntado");
if(saved) playersEl.innerHTML=saved;
</script>

</body>
</html>